<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRI KRISHNA GHAR | Payment & Menu</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --accent: #f59e0b;
            --success: #10b981;
            --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            --glass: rgba(255, 255, 255, 0.06);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }

        body {
            background: var(--bg-gradient);
            background-attachment: fixed;
            min-height: 100vh;
            color: #f8fafc;
            padding: 20px;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        header {
            text-align: center;
            padding: 30px 0;
            animation: fadeInDown 0.8s ease-out;
        }

        .logo {
            font-size: 2.8rem;
            font-weight: 800;
            letter-spacing: -1px;
            background: linear-gradient(to right, #fbbf24, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle { color: #94a3b8; letter-spacing: 4px; font-size: 0.9rem; text-transform: uppercase; }

        /* Main Grid */
        .layout-grid {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            margin-top: 20px;
        }

        @media (max-width: 1024px) { .layout-grid { grid-template-columns: 1fr; } }

        /* MENU SECTION */
        .menu-section {
            background: var(--glass);
            border-radius: 32px;
            padding: 30px;
            border: 1px solid var(--glass-border);
        }

        .category-title {
            color: var(--accent);
            font-size: 1.4rem;
            margin: 25px 0 15px;
            border-left: 4px solid var(--accent);
            padding-left: 15px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
        }

        .menu-item {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--glass-border);
            padding: 15px;
            border-radius: 18px;
            text-align: center;
            transition: 0.3s;
            font-size: 0.95rem;
        }

        .menu-item:hover {
            background: var(--glass-border);
            transform: translateY(-3px);
            border-color: var(--accent);
        }

        /* PAYMENT PANEL (Keeps your logic) */
        .payment-panel {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 32px;
            padding: 30px;
            height: fit-content;
            position: sticky;
            top: 20px;
            border: 1px solid var(--primary);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        .token-card {
            background: var(--primary);
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 15px;
            transition: 0.3s;
        }

        .token-card:hover { transform: scale(1.05); filter: brightness(1.2); }

        .token-number { font-size: 1.8rem; font-weight: 800; display: block; }

        .token-amount { font-weight: 600; color: #fff; background: rgba(0,0,0,0.2); padding: 5px 10px; border-radius: 10px; margin-top: 5px; display: inline-block;}

        .refresh-btn {
            width: 100%;
            padding: 15px;
            border-radius: 15px;
            border: none;
            background: white;
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
        }

        /* Status UI */
        .loading, .empty-state, .error-state { text-align: center; padding: 40px 0; }
        .spinner { width: 40px; height: 40px; border: 3px solid #333; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s infinite linear; margin: 0 auto 15px; }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        /* Success Overlay */
        .success-message {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; color: #111; padding: 40px; border-radius: 30px;
            z-index: 1000; display: none; text-align: center; width: 90%; max-width: 400px;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="logo">SRI KRISHNA GHAR</div>
        <div class="subtitle">Authentic & Pure</div>
    </header>

    <div class="layout-grid">
        <main class="menu-section">
            <h2 style="font-weight: 800; font-size: 1.8rem;">Our Menu</h2>
            
            <div class="category-title">Signature Combos</div>
            <div class="menu-grid">
                <div class="menu-item">Phulka combo</div>
                <div class="menu-item">Paratha combo</div>
            </div>

            <div class="category-title">Specialty Rotis & Thepla</div>
            <div class="menu-grid">
                <div class="menu-item">Missi roti</div><div class="menu-item">Methi roti</div>
                <div class="menu-item">Palak roti</div><div class="menu-item">Sattu roti</div>
                <div class="menu-item">Beetroot roti</div><div class="menu-item">Ragi roti</div>
                <div class="menu-item">Jaur roti</div><div class="menu-item">Bajra roti</div>
                <div class="menu-item">Makai roti</div><div class="menu-item">Thepla</div>
            </div>

            <div class="category-title">Stuffed Parathas</div>
            <div class="menu-grid">
                <div class="menu-item">Aloo paratha</div><div class="menu-item">Sattu paratha</div>
                <div class="menu-item">Gobi paratha</div><div class="menu-item">Methi paratha</div>
                <div class="menu-item">Paneer paratha</div><div class="menu-item">Cheese paratha</div>
                <div class="menu-item">Mix veg paratha</div>
            </div>

            <div class="category-title">Puri & Bhatura</div>
            <div class="menu-grid">
                <div class="menu-item">Normal puri</div><div class="menu-item">Chala bhatura</div>
                <div class="menu-item">Methi puri</div><div class="menu-item">Sattu puri</div>
                <div class="menu-item">Matar puri</div>
            </div>

            <div class="category-title">Rice Specials</div>
            <div class="menu-grid">
                <div class="menu-item">Dal chawal</div><div class="menu-item">Chola chawal</div>
                <div class="menu-item">Rajma chawal</div><div class="menu-item">Kadhi chawal</div>
                <div class="menu-item">Veg pulao</div><div class="menu-item">Tawa pulao</div>
                <div class="menu-item">Jeera rice</div><div class="menu-item">Veg biryani</div>
            </div>

            <div class="category-title">Tandoor & Chat</div>
            <div class="menu-grid">
                <div class="menu-item">Tanduri roti</div><div class="menu-item">Butter naan</div>
                <div class="menu-item">Garlic naan</div><div class="menu-item">Stuff kulcha</div>
                <div class="menu-item">Samosa</div><div class="menu-item">Kachori</div>
                <div class="menu-item">Pani Puri</div><div class="menu-item">Vada pav</div>
                <div class="menu-item">Pav bhaji</div>
            </div>

            <div class="category-title">Beverages</div>
            <div class="menu-grid">
                <div class="menu-item" style="border-color: var(--accent);">Dryfruits Lassi</div>
                <div class="menu-item" style="border-color: var(--accent);">Dryfruits Aamrash</div>
            </div>
        </main>

        <aside class="payment-panel">
            <h3 style="margin-bottom: 20px; display: flex; justify-content: space-between;">
                Pay Bill <span id="tokenCount" style="font-size: 0.8rem; background: var(--accent); padding: 2px 8px; border-radius: 10px;">0</span>
            </h3>

            <div id="loadingState" class="loading">
                <div class="spinner"></div>
                <p>Checking tokens...</p>
            </div>

            <div id="tokenGrid"></div>

            <div id="emptyState" class="empty-state" style="display: none;">
                <p style="color: #94a3b8;">No pending payments.</p>
            </div>

            <div id="errorState" class="error-state" style="display: none;">
                <p id="errorMessage" style="color: #ef4444; font-size: 0.8rem;"></p>
            </div>

            <button class="refresh-btn" onclick="loadTokens()">ðŸ”„ Refresh Payments</button>
            <p style="text-align: center; font-size: 0.7rem; color: #94a3b8; margin-top: 15px;">ðŸ”’ Secured by Razorpay</p>
        </aside>
    </div>

    <div id="successMessage" class="success-message">
        <div style="font-size: 50px;">âœ…</div>
        <h2>Payment Done</h2>
        <div id="successToken" style="font-size: 2rem; font-weight: 800; color: var(--primary); margin: 10px 0;">#00</div>
        <p>Your bill is printing at the counter.</p>
        <button class="refresh-btn" style="background: var(--primary); color: white;" onclick="location.reload()">Close</button>
    </div>
</div>

<script>
    /* LOGIC REMAINS UNTOUCHED AS REQUESTED */
    const API_BASE = window.location.origin;
    
    async function loadTokens() {
        const loadingState = document.getElementById('loadingState');
        const tokenGrid = document.getElementById('tokenGrid');
        const emptyState = document.getElementById('emptyState');
        const errorState = document.getElementById('errorState');
        const tokenCount = document.getElementById('tokenCount');

        loadingState.style.display = 'block';
        emptyState.style.display = 'none';
        errorState.style.display = 'none';
        tokenGrid.innerHTML = '';

        try {
            const response = await fetch(`${API_BASE}/api/pending-tokens`, { cache: 'no-cache' });
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            const data = await response.json();
            
            loadingState.style.display = 'none';
            if (data.tokens && data.tokens.length > 0) {
                tokenCount.textContent = data.tokens.length;
                data.tokens.forEach(token => {
                    const card = document.createElement('div');
                    card.className = 'token-card';
                    card.onclick = () => initiatePayment(token.token_number, token.amount);
                    card.innerHTML = `
                        <span class="token-number">#${token.token_number}</span>
                        <span class="token-amount">Pay â‚¹${token.amount}</span>
                    `;
                    tokenGrid.appendChild(card);
                });
            } else {
                emptyState.style.display = 'block';
                tokenCount.textContent = '0';
            }
        } catch (error) {
            loadingState.style.display = 'none';
            errorState.style.display = 'block';
            document.getElementById('errorMessage').textContent = 'Connection Error';
        }
    }

    async function initiatePayment(tokenNumber, amount) {
        try {
            const response = await fetch(`${API_BASE}/api/create-order`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token_number: tokenNumber })
            });
            const orderData = await response.json();
            if (!response.ok) { alert(orderData.error); return; }

            const options = {
                key: orderData.key,
                amount: orderData.amount,
                currency: orderData.currency,
                name: 'SRI KRISHNA GHAR',
                description: `Token #${tokenNumber}`,
                order_id: orderData.order_id,
                handler: function (res) { showSuccess(tokenNumber); },
                theme: { color: '#6366f1' }
            };
            new Razorpay(options).open();
        } catch (error) { alert('Error: ' + error.message); }
    }

    function showSuccess(tokenNumber) {
        document.getElementById('successToken').textContent = `#${tokenNumber}`;
        document.getElementById('successMessage').style.display = 'block';
    }

    window.onload = loadTokens;
    setInterval(() => {
        if (document.getElementById('successMessage').style.display === 'none') loadTokens();
    }, 10000);
</script>
</body>
</html>
